<title>pictuto1</title><p style="text-align: center;"><span style="font-size: x-large;">Medindo Corrente com PIC 16F877A</span></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: justify;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bom, darei aqui uma explica&ccedil;&atilde;o de como fazer um medidor de corrente com um PIC 16F877A (programando em C). Estarei usando como simulador o <strong>Proteus ISIS</strong> e como IDE o <strong>CCS C.</strong></p>
<p style="text-align: justify;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>Aqui est&aacute; o circuito ao qual mediremos a corrente:</p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=162" alt="" width="530" height="320" /></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Uma bateria de 12V ligada a uma l&acirc;mpada de 12V com 24 &Omega; de resistencia e seus respectivos medidores de tens&atilde;o e corrente. Ligando esse circuito obtemos os valores de 0,5A (mais precisamente 496mA) e 12V na l&acirc;mpada.</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=163" alt="" width="506" height="332" /></p>
<p style="text-align: justify;">&nbsp;&nbsp;&nbsp;&nbsp; Para medirmos a corrente, &eacute; nescessario um <strong>shunt</strong>, que neste caso podemos usar um resistor de resistencia relativamente baixa, como 0,1&Omega;. Este resistor ser&aacute; colocado em s&eacute;rie com a l&acirc;mpada, no polo negativo. Ao ligar obtemos os seguintes valores:</p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=165" alt="" width="397" height="423" /></p>
<p style="text-align: center;">&nbsp;&nbsp;&nbsp; 49,6mV no resistor. Usando a Lei de Ohm como <strong>U = R * I </strong>podemos chegar a corrente:</p>
<p style="text-align: center;">49,6 * 10^-3 = 0,1 * I</p>
<p style="text-align: center;">49,6 * 10^-3 / 0,1 = I</p>
<p style="text-align: center;">496 * 10^-3 = I</p>
<p style="text-align: center;"><strong>I = 496 mA</strong></p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: center;">Ok, na entrada anal&oacute;gica do microcontrolador PIC16F877A, h&aacute; uma especifica&ccedil;&atilde;o de tens&atilde;o maxima. No caso, &eacute; +Vcc a GND caso n&atilde;o seja acertada a referencia. Com Vcc = 5V e GND = 0 temos 5V de espa&ccedil;o, por&eacute;m o valor 49,6mV &eacute; muito baixo para isto, logo nescessitaremos aumenta-lo com um <strong>Amplificador Operacional</strong>.</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=166" alt="" width="471" height="393" /></p>
<p style="text-align: center;">Com o modo <strong>Amplificador Inversor </strong>do amplificador operacional podemos facilmente multiplicar a tens&atilde;o de entrada, no simular as tens&otilde;es&nbsp; de alimenta&ccedil;&atilde;o do amplificador operacional est&atilde;o acertadas para +15V e -15V, muito mais altas do que o que nescessitamos.</p>
<p style="text-align: center;">Podemos calcular o <strong>Ganho de Tens&atilde;o </strong>do amplificador operacional da seguinte maneira:</p>
<p style="text-align: center;"><strong>Vout =&nbsp; - ( Vin * ( R2 / R1 ) )<br /></strong></p>
<p style="text-align: center;">Como a tens&atilde;o maxima da entrada anal&oacute;gica do PIC sendo 5V, podemos multiplicar por 10 nesse primeiro estagio. Selecionamos os resistores <strong>R1 </strong>e <strong>R2&nbsp; </strong>para 100&Omega; e 10k&Omega; respectivamente.</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=167" alt="" width="531" height="324" /></p>
<p style="text-align: center;">Por&eacute;m assim, temos uma tens&atilde;o negativa, n&atilde;o podendo ser usada para o PIC, e caso queiramos uma lampada de maior pot&ecirc;ncia estaremos muito proximo do limite maximo do PIC (4,95V), ent&atilde;o colocaremos outro amplificador operacional no modo inversor para dividir a tens&atilde;o por 2.</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=168" alt="" width="800" height="341" /></p>
<p style="text-align: center;">Ent&atilde;o a saida &eacute; 2,48V, metade da entrada do PIC, podendo assim usar uma l&acirc;mpada do dobro da pot&ecirc;ncia. Ent&atilde;o agora vamos descobrir a formula geral desse circuito para acharmos a corrente apartir da tens&atilde;o de saida.</p>
<p style="text-align: center;">Para corrente I no resistor de 0,1&Omega; temos uma saida V temos: <strong>I = V / 0 , 1</strong></p>
<p style="text-align: center;">Ap&oacute;s isso, com amplificadores operacionais multiplicamos por 100 e dividimos por 2. Logo multiplicamos por 50. Logo Vout = Vin * 50.</p>
<p style="text-align: center;">Assim <strong>Vin = Vout / 50</strong>. Jogando isso na formula anterior temos:</p>
<p style="text-align: center;">I = Vout / 50 * 0,1</p>
<p style="text-align: center;"><strong>I = Vout / 5</strong></p>
<p style="text-align: center;">Chegamos ai a formula final que precisaremos usar no programa do PIC para calcular a corrente apartir da tens&atilde;o na entrada dele.</p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;"><span style="font-size: x-large;">CCS C</span></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">Para a visualiza&ccedil;&atilde;o dos valores recebidos pelo microcontrolador, estarei usando um LCD HD44780 (o mais comum) ligado a PORTD do PIC16F877A. No CCS C, o driver de LCD j&aacute; est&aacute; configurado para essa porta. O circuito para simula&ccedil;&atilde;o ser&aacute; este:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=169" alt="" width="785" height="517" /></p>
<p style="text-align: center;">Tudo acertado iremos come&ccedil;ar o programa no CCS C ent&atilde;o:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=178" alt="" width="800" height="750" /></p>
<p style="text-align: center;">Iremos em <strong>Project Wizard</strong> e acertaremos as configura&ccedil;&otilde;es como nas imagens abaixo:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=179" alt="" width="746" height="650" /></p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=180" alt="" width="748" height="652" /></p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=181" alt="" width="747" height="650" /></p>
<p style="text-align: center;">Ap&oacute;s tudo acertado, iremos para uma tela semelhante a essa:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=182" alt="" width="800" height="749" /></p>
<p style="text-align: center;">O que configuramos foi o seguinte:</p>
<p style="text-align: center;">- O modelo pic para 16F877A</p>
<p style="text-align: center;">- O pic para rodar em 4Mhz</p>
<p style="text-align: center;">- O pic para usar Oscilador a Cristal</p>
<p style="text-align: center;">- O pic para usar Ponteiros de 16Bit para uso da Ram inteira.</p>
<p style="text-align: center;">Come&ccedil;aremos ent&atilde;o colocando uma linha que incluir&aacute; o driver do LCD do CCS C e tamb&eacute;m variaveis que vamos usar no programa. Adicionaremos est&aacute; linha abaixo do primeiro <strong>#include</strong>:</p>
<p style="text-align: center;"><strong>#include </strong></p>
<p style="text-align: center;"><strong>long int valor;</strong></p>
<p style="text-align: center;"><strong>float tensao;</strong></p>
<p style="text-align: center;">Ap&oacute;s feito isso, podemos come&ccedil;ar a escrever o c&oacute;digo, exatamente onde o CCS C deixou escrito <strong>// TODO: USER CODE!!</strong></p>
<p style="text-align: center;">Come&ccedil;aremos com a inicializa&ccedil;&atilde;o do LCD e ap&oacute;s isso faremos um programa de teste para escrever no LCD.</p>
<p style="text-align: center;"><strong>&nbsp;&nbsp; lcd_init();<br />&nbsp;&nbsp; lcd_putc("Teste do LCD!");<br />&nbsp;&nbsp; while(true) {}</strong></p>
<p style="text-align: center;">Aperte F9 para compilar o programa, e vamos agora configurar no <strong>ISIS</strong> para a simula&ccedil;&atilde;o do programa compilado.</p>
<p style="text-align: center;">Clicaremos <strong>uma </strong>vez com bot&atilde;o direito, e <strong>uma&nbsp; </strong>vez com bot&atilde;o esquerdo em cima do pic, e ir&aacute; abrir uma janela igual a esta:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=170" alt="" width="601" height="424" /></p>
<p style="text-align: center;">No campo marcado na imagem, selecione o arquivo compilado (nome_do_programa.hex) e ap&oacute;s isso acerte o <strong>Processor Clock Frequency</strong> para 4Mhz:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=171" alt="" width="598" height="418" /></p>
<p style="text-align: center;">Ap&oacute;s feito isso podemos j&aacute; simular e ver se deu certo. Clique no bot&atilde;o <strong>play</strong> na barra inferior do ISIS:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=172" alt="" width="771" height="514" /></p>
<p style="text-align: center;">Hmm, muito bom! Funciona! Agora vamos a parte do <strong>conversor anal&oacute;gico-digital</strong>. Iremos escrever as seguintes linhas dentro do la&ccedil;o <strong>while</strong> ( dentro das chaves {&nbsp; } )</p>
<p style="text-align: center;"><strong>&nbsp;&nbsp; &nbsp;&nbsp; SET_ADC_CHANNEL(0);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; valor = READ_ADC(7);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; printf(lcd_putc,"\f Valor: %LU",valor);</strong></p>
<p style="text-align: center;">Fazendo isso, acertar o canal de leitura do ADC para o 0 (primeiro), esperar 10ms, iniciar e ler (7), e colocar o conteudo na vari&aacute;vel valor, esperar 10ms novamente, e depois mostrar o valor no lcd. Compile o programa, mas antes de rodar, &eacute; nescess&aacute;rio a liga&ccedil;&atilde;o do sinal de saida do amplificador operacional no pino A0 do PIC.</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=173" alt="" width="800" height="712" /></p>
<p style="text-align: center;">Ap&oacute;s ligado isso, podemos testar:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=174" alt="" width="800" height="700" /></p>
<p style="text-align: center;">Certo, funcionou. Mas e esse valor <strong>507</strong>? Bom, este seria o valor que o ADC forneceu. Para sabermos a tens&atilde;o da entrada, precisamos saber de onde o ADC tirou isso. Antes falamos que a tens&atilde;o que teriamos seria de 0V a 5V, e nas defini&ccedil;&otilde;es acertamos a precis&atilde;o do ADC para 1024bit. logo temos 5 / 1024 V de precis&atilde;o, ou seja, cada bit ser&aacute; equivalente a 5 / 1024 V.</p>
<p style="text-align: center;">5 / 1024 = 0.0048828125</p>
<p style="text-align: center;">Logo faremos o seguinte, multiplicaremos o valor que conseguimos por esse numero, assim teremos em volts a tens&atilde;o na entrada do pic.</p>
<p style="text-align: center;">Ok, trocaremos as linhas dentro do la&ccedil;o while pelo seguinte:</p>
<p style="text-align: center;"><strong>&nbsp;&nbsp; SET_ADC_CHANNEL(0);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; valor = READ_ADC(7);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; tensao = valor * 0.0048828125;<br />&nbsp;&nbsp; printf(lcd_putc,"\f Tensao: %F",tensao);</strong></p>
<p style="text-align: center;">Mesma coisa do que o anterior, apenas usando a <strong>float</strong> valor para casas depois da virgula. A saida da float ser&aacute; arredondada para 2 casas decimais. Compilando e rodando, temos:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=175" alt="" width="800" height="703" /></p>
<p style="text-align: center;">Temos 2,47V, algo bem proxim dos 2,48V medidos com voltimetro. Ok, temos a tens&atilde;o certinha, agora precisamos aplicar a f&oacute;rmula dada la em cima. Por&eacute;m, a corrente est&aacute; abaixo de 1 Amper, logo podemos fazer a visualiza&ccedil;&atilde;o em mA apenas multiplicando tudo por 1000. Faremos o seguinte ent&atilde;o:</p>
<p style="text-align: center;">&nbsp;<strong>&nbsp; SET_ADC_CHANNEL(0);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; valor = READ_ADC(7);<br />&nbsp;&nbsp; delay_ms(10);<br />&nbsp;&nbsp; tensao = valor * 0.0048828125 / 5 * 1000;<br />&nbsp;&nbsp; printf(lcd_putc,"\f I: %FmA",tensao);</strong></p>
<p style="text-align: center;">Divindindo a tens&atilde;o que foi conseguida por 5 e multiplicando por 1000, compilando e rodando temos:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=176" alt="" width="800" height="701" /></p>
<p style="text-align: center;">Temos 495,11mA, proximo dos 496mA medidos com Miliamperimetro. Para verificar a funcionalidade do circuito, alteremos a resistencia da lampada para 12 Ohms (em teoria, a corrente ir&aacute; dobrar), no campo indicado, trocar 24 por 12</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=161" alt="" width="508" height="366" /></p>
<p style="text-align: center;">Testando:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=177" alt="" width="800" height="697" /></p>
<p style="text-align: center;">Pronto =), tudo funcionando nos conformes. Simples n&atilde;o?</p>
<p style="text-align: center;">Quer uma sugest&atilde;o para projeto de aprendizagem? Tente fazer um circuito que me&ccedil;a a pot&ecirc;ncia na carga, medindo a tens&atilde;o na carga e a corrente, e multiplicando as duas.</p>
<p style="text-align: center;">C&oacute;digo final:</p>
<p style="text-align: center;"><img border=0 src="get.php@arquivo=185" alt="" width="776" height="476" /></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;"><span style="font-size: large;">Documento por: Lucas Teske</span></p>
<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img border=0 style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" alt="Licen&ccedil;a Creative Commons" /></a><br />Esta <span>obra</span> de <a rel="cc:attributionURL" href="../ver-documento/832.html">EnergyLabs Brasil</a>, foi licenciada com uma Licen&ccedil;a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons - Atribui&ccedil;&atilde;o - Partilha nos Mesmos Termos 3.0 N&atilde;o Adaptada</a>.<br />Permiss&otilde;es adicionais ao &acirc;mbito desta licen&ccedil;a podem estar dispon&iacute;veis em <a rel="cc:morePermissions" href="../ver-documento/832.html">http://www.energylabs.com.br</a>.</p>